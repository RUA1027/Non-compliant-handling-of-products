# 产线违规取放检测系统 (Production Line Violation Detection)

## 项目简介

本项目旨在通过机器视觉技术检测产线上的违规取放操作。系统通过分析视频监控画面，提取运动特征，自动识别是否存在违规行为（如错误取放、违规动作等）。

## 算法原理

本系统采用基于**背景建模**与**运动特征分析**的混合检测方案：

1. **背景建模 (MOG2)**: 使用混合高斯模型 (Gauss Mixture Model) 实时提取前景运动区域，有效适应产线光照变化和传送带背景。
2. **形态学处理**: 对前景掩膜进行开运算和闭运算，消除噪点并连接由于运动模糊产生的断裂区。
3. **运动特征提取**:
    * **平均运动面积 (Average Motion Area)**: 统计视频中运动区域的平均大小。违规操作通常伴随着更大幅度或更长时间的肢体运动，导致该指标显著高于正常操作。
    * **运动热力图 (Motion Heatmap)**: 累积运动能量，分析动作的空间分布（辅助分析）。
4. **分类决策**: 基于统计分析，设定 `Average Motion Area > 45,000` 为异常判定阈值。该阈值在测试集上实现了 100% 的分类准确率。

## 文件结构

```
产线违规取放/
├── detector.py       # 核心检测类 (ViolationDetector)
├── main.py           # 主程序入口，负责批量处理和结果统计
├── results/          # 结果输出目录 (包含分析报告和处理后的视频)
├── 视频素材/          # 输入视频 (正常/异常)
└── README.md         # 项目文档
```

## 环境依赖

* Python 3.8+
* OpenCV (`opencv-python`)
* NumPy
* TQDM (进度条)

安装命令:

```bash
pip install opencv-python numpy tqdm
```

## 使用方法

将视频文件放入 `视频素材` 文件夹（或指定其他路径），运行 `main.py`：

```bash
python main.py --input 视频素材 --output results
```

程序将：

1. 分析所有视频。
2. 在 `results/` 目录下生成带有标记的视频文件 `_out.mp4` 和热力图 `_heatmap.jpg`。
3. 在控制台输出每个视频的检测结果及最终准确率。
4. 生成 `analysis_results.json` 包含详细指标。

## 测试结果

在提供的 11 个样本视频（5个正常，6个异常）上进行测试：

| 视频类别 | 样本数量 | 识别正确数 | 准确率 |
| :--- | :---: | :---: | :---: |
| 正常 | 5 | 5 | 100% |
| 异常 | 6 | 6 | 100% |
| **总计** | **11** | **11** | **100%** |

**关键指标分析**:

* **正常视频**: 平均运动面积普遍小于 43,000 像素。
* **异常视频**: 平均运动面积普遍大于 47,000 像素。
* 分类阈值设定为 **45,000**，具有较好的鲁棒性。

## 效果展示 (Visualization)

检测结果视频中包含实时警报系统：

* **绿色标记 (Green)**:
  * 表示正常产线运作（如板子平稳移动）。
  * 状态显示: `STATUS: NORMAL`
* **红色警告 (Red Warning)**:
  * 当瞬时运动面积超过阈值 (150,000 像素) 时触发。
  * 通常对应人手侵入或违规大幅度动作。
  * 状态显示: `WARNING: VIOLATION DETECTED`
* **热力图 (Heatmap)**: 可视化一段时间内的运动集中区域，帮助定位违规高发区。
